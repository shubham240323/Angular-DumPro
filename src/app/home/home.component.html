
<div class="container-fluid my-3">
  <div class="row g-3 align-items-center">
    <div class="col-md-3">
      <input
        type="text"
        class="form-control"
        [(ngModel)]="filters.SearchBookName"
        placeholder="Search by book name"
      />
    </div>

    <div class="col-md-3">
      <ng-select
        [items]="departments"
        bindLabel="DepartmentName"
        bindValue="DepartmentId"
        [(ngModel)]="filters.SelectedDepartmentId"
        [multiple]="false"
        [searchable]="true"
        placeholder="Select Department"
        class="w-100"
      ></ng-select>
    </div>

    <div class="col-md-4">
      <ng-select
        [items]="vendors"
        bindLabel="PublicationName"
        bindValue="PublicationId"
        [(ngModel)]="filters.SelectedPublicationIds"
        [multiple]="true"
        [searchable]="true"
        placeholder="Select Publications"
        class="w-100"
      ></ng-select>
    </div>

    <div class="col-md-2 d-flex gap-2">
      <button class="btn btn-primary w-100" (click)="searchBooks()">Search</button>
      <button class="btn btn-secondary w-100" (click)="resetFilters()">Reset</button>
    </div>
  </div>
</div>


<div class="d-flex justify-content-between align-items-center mt-4 mb-2">
  <h2 class="m-0">Book List</h2>

  <div class="d-flex align-items-center gap-2">
    <button class="btn btn-primary" (click)="onAddIssue()">
  Add New Issue
</button>
    <button class="btn btn-success d-flex" (click)="onAddBook()">Add Book</button>
    <button class="btn btn-success d-flex align-items-center" (click)="openBookModal()">
      <i class="bi bi-plus-circle"></i>
    </button>
  </div>
</div>


<div class="table-responsive">
  <table class="table table-bordered table-striped table-hover mt-3">
    <thead class="table-dark">
      <tr>
        <th (click)="sortData('BookID')">Book ID {{ getSortArrow('BookID') }}</th>
        <th (click)="sortData('BookName')">Book Name {{ getSortArrow('BookName') }}</th>
        <th (click)="sortData('PublicationName')">Publication {{ getSortArrow('PublicationName') }}</th>
        <th (click)="sortData('DepartmentName')">Department {{ getSortArrow('DepartmentName') }}</th>
        <th>Created By</th>
        <th>Created On</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let book of books">
        <td>{{ book.BookID }}</td>
        <td>{{ book.BookName }}</td>
        <td>{{ book.PublicationName }}</td>
        <td>{{ book.DepartmentName }}</td>
        <td>{{ book.CreatedByName }}</td>
        <td>{{ book.CreatedOn | date: 'medium' }}</td>
        <td>
          <div class="btn-group" role="group">
            <button class="btn btn-sm btn-primary" (click)="onEditBook(book.BookID)">
              <i class="bi bi-pencil-square"></i>
            </button>
            <button class="btn btn-sm btn-success" (click)="openBookModal(book)">
              <i class="bi bi-eye"></i>
            </button>
            <button class="btn btn-sm btn-danger" (click)="confirmDelete(book.BookID)">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>


<div class="container my-3">
  <div class="d-flex flex-wrap justify-content-between align-items-center gap-3">
    <div class="d-flex align-items-center">
      <label class="form-label m-0 me-2">Page Size:</label>
      <select
        class="form-select w-auto"
        [(ngModel)]="filters.PageSize"
        (change)="GetBookList()"
      >
        <option *ngFor="let size of pageSizes" [value]="size">
          {{ size }}
        </option>
      </select>
    </div>

    <ngb-pagination
      [collectionSize]="totalRecords"
      [(page)]="filters.PageNumber"
      [pageSize]="filters.PageSize"
      (pageChange)="GetBookList()"
    ></ngb-pagination>
  </div>
</div>


<ng-template #bookModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">{{ selectedBook.BookID ? 'Edit Book' : 'Add Book' }}</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>

  <div class="modal-body">
    <form #bookForm="ngForm" class="row">
      <div class="col-md-12 mb-3">
        <label class="form-label">Book Name</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="selectedBook.BookName"
          name="BookName"
          required
          placeholder="Enter Book Name"
        />
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">Publication</label>
        <ng-select
          [items]="vendors"
          bindLabel="PublicationName"
          bindValue="PublicationId"
          [(ngModel)]="selectedBook.PublicationId"
          name="PublicationId"
          placeholder="-- Select Publication --"
          [clearable]="true"
          required
        ></ng-select>
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">Department</label>
        <ng-select
          [items]="departments"
          bindLabel="DepartmentName"
          bindValue="DepartmentId"
          [(ngModel)]="selectedBook.DepartmentId"
          name="DepartmentId"
          placeholder="-- Select Department --"
          [clearable]="true"
          [searchable]="true"
          required
        ></ng-select>
      </div>

  <div class="col-md-6 mb-3">
      <input
        type="checkbox"
        class="form-check-input"
        id="isActive"
        [(ngModel)]="selectedBook.IsActive"
        name="IsActive"
      />
      <label class="form-check-label" for="isActive">Is Active</label>
    </div>
    </form>
  </div>


  <div class="modal-footer">
    <button class="btn btn-primary" (click)="saveBook(modal)">Save</button>
    <button class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
  </div>
</ng-template>

